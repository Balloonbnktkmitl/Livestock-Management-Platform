<!DOCTYPE html>
<html lang="en,th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="/frontend/dist/output.css">
</head>
<body>
    <form method="POST" action="/register/success">
        <div class="grid grid-cols-1 sm:grid-cols-2 h-screen w-full" style="background-image: url('frontend/src/img/bg_reg.jpg');">
            <div class="bg-green-500 opacity-30 w-full h-full objext-cover hidden sm:block">
            </div>
            <div class="bg-white rounded-l-lg">

                <!-- Page1 -->
                <div id="page-1" class="bg-white w-2/3 pb-16 px-12 mx-auto mt-[130px]">
                    <h2 class="text-3xl mb-[100px] font-bold">Create a new account</h2>
                        <div class="mb-[30px]">
                            <label class="block mb-2 font-medium">Username</label>
                            <input type="text" id="username" name="username" class="bg-gray-200 rounded-full w-full py-2 px-4" required>
                        </div>
                        <div class="mb-[30px]">
                            <label class="block mb-2 font-medium">Password</label>
                            <input type="password" id="password" name="password" class="bg-gray-200 rounded-full w-full py-2 px-4" required>
                        </div>
                        <div class="flex justify-between">
                            <!-- Previous button -->
                            <button 
                                id="btn1-back"
                                type="button"
                                onclick="goBack()"
                                class="bg-orange-500 text-white font-bold rounded-full py-2 px-4 w-[130px] flex mx-auto">previous
                                 <img width="10" src="frontend/src/svg/arrow_left.svg" class="mt-2 ml-2"/>
                            </button>

                            <!-- Next button -->
                            <button 
                                id="btn1-next"
                                type="button"
                                onclick="check_data()"
                                class="bg-orange-500 text-white font-bold rounded-full py-2 px-4 w-[130px] flex mx-auto">next page
                                <img width="10" src="frontend/src/svg/arrow_right.svg" class="mt-2 ml-2"/>
                            </button>
                        </div>
                </div>

                <!-- Page2 -->
                <div id="page-2" class="bg-white w-4/5 pb-16 px-12 mx-auto mt-[80px] hidden">
                    <h2 class="text-3xl mb-[70px] font-bold">Create a new account</h2>
                        <div class="grid grid-cols-2 gap-5 mb-[20px]">
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">First Name</label>
                                <input type="text" class="bg-gray-200 rounded-full w-full py-2 px-4" id="firstname" name="firstname" required>
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Last Name</label>
                                <input type="text" class="bg-gray-200 rounded-full w-full py-2 px-4" id="lastname" name="lastname" required>
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Phone Number</label>
                                <input type="tel" class="bg-gray-200 rounded-full w-full py-2 px-4" id="phone" name="phone" required>
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Email</label>
                                <input type="email" class="bg-gray-200 rounded-full w-full py-2 px-4" id="email" name="email" required>
                            </div>

                            <div class="block mb-3">
                            <label for="role" class="font-medium">Gender</label>
                            <label for="role" class="font-medium text-red-500">**</label>
                            <label for="role" class="font-medium text-gray-500 text-sm">(Customer or Farm Owner)</label>
                            </div>
                        </div>

                        <div class="mb-4 grid grid-cols-2">
                            <div class="relative">
                                <select
                                    class="border-solid bg-gray-300 rounded-full py-2 px-4 w-full" name="gender" id="gender" required>
                                    <option value="null">--select a gender--</option>
                                    <option value="Male">Male</option>
                                    <option value="Female">Female</option>
                                    <option value="Other">Other</option>
                                </select>
                            </div>
                        </div>

                        <div class="block mb-3">
                            <label for="role" class="font-medium">Role</label>
                            <label for="role" class="font-medium text-red-500">**</label>
                            <label for="role" class="font-medium text-gray-500 text-sm">(Customer or Farm Owner)</label>
                        </div>

                        <div class="mb-4 grid grid-cols-2">
                            <div class="relative">
                                <select
                                    class="border-solid bg-gray-300 rounded-full py-2 px-4 w-full" id="role" name="role" required>
                                    <option value="null">--select a role--</option>
                                    <option value="Customer">Customer</option>
                                    <option value="FarmOwner">Farm Owner</option>
                                </select>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 mb-[20px]">
                            <div>
                                <label class="block mb-2 font-medium">Address</label>
                                <input type="text" class="bg-gray-200 rounded-full w-full py-2 px-4" name="address" required>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-5">
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">City</label>
                                <input type="text" class="bg-gray-200 rounded-full w-full py-2 px-4" name="city" required>
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Country</label>
                                <input type="text" class="bg-gray-200 rounded-full w-full py-2 px-4" name="country" required>
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Region</label>
                                <input type="text" class="bg-gray-200 rounded-full w-full py-2 px-4" name="region" required>
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Zip</label>
                                <input type="text" class="bg-gray-200 rounded-full w-full py-2 px-4" name="zip" required>
                            </div>
                        </div>

                        <div class="flex mt-[60px]">
                            <button
                            id="btn2-back"
                            type="button"
                            onclick="goBack()"
                            class="bg-orange-500 text-white font-bold rounded-full py-2 px-4 flex mr-[260px]">back page
                                <img width="10" src="frontend/src/svg/arrow_left.svg" class="mt-2 mr-3"/>
                            </button>
                            <button 
                            id="btn2-next"
                            type="button"
                            onclick="check_data()"
                            class="bg-orange-500 text-white font-bold rounded-full py-2 px-4 flex">next page
                                <img width="10" src="frontend/src/svg/arrow_right.svg" class="mt-2 ml-3"/>
                            </button>
                        </div>
                </div>

                <!--- page 3--->
                <div id="page-3" class="bg-white w-4/5 pb-16 px-12 mx-auto mt-[80px] hidden">
                    <h2 class="text-3xl mb-[70px] font-bold">Create a new account</h2>
                        <div class="grid grid-cols-2 gap-5 mb-[20px]">
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">FarmName</label>
                                <input type="text" name="farm_name" class="bg-gray-200 rounded-full w-full py-2 px-4">
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Farm_Email</label>
                                <input type="email" name="farm_email" class="bg-gray-200 rounded-full w-full py-2 px-4">
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Farm_PhoneNumber</label>
                                <input type="tel" name="farm_phone" class="bg-gray-200 rounded-full w-full py-2 px-4">
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Farm_Address</label>
                                <input type="text" name="farm_address" class="bg-gray-200 rounded-full w-full py-2 px-4">
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Farm_City</label>
                                <input type="text" name="farm_city" class="bg-gray-200 rounded-full w-full py-2 px-4">
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Farm_Country</label>
                                <input type="text" name="farm_country" class="bg-gray-200 rounded-full w-full py-2 px-4">
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Farm_Region</label>
                                <input type="text" name="farm_region" class="bg-gray-200 rounded-full w-full py-2 px-4">
                            </div>
                            <div class="mb-[1px]">
                                <label class="block mb-2 font-medium">Farm_zip</label>
                                <input type="text" name="farm_zip" class="bg-gray-200 rounded-full w-full py-2 px-4">
                            </div>
                        </div>
                        <div class="flex mt-[60px]">
                            <button
                            id="btn3-back"
                            type="button"
                            onclick="goBack()"
                            class="bg-orange-500 text-white font-bold rounded-full py-2 px-4 flex mr-[260px]">
                                <img width="10" src="frontend/src/svg/arrow_left.svg" class="mt-2 mr-3"/>
                                back page
                            </button>
                            <button 
                            id="btn3-next"
                            type="button"
                            onclick="check_data()"
                            class="bg-orange-500 text-white font-bold rounded-full py-2 px-4 flex">next page
                                <img width="10" src="frontend/src/svg/arrow_right.svg" class="mt-2 ml-3"/>
                            </button>
                        </div>
                </div>

                <!-- Page4 -->
                <div id="page-4" class="bg-white w-4/5 pb-16 px-12 mx-auto mt-[130px] hidden">
                    <h2 class="text-4xl font-bold text-center">Register Complete!</h2>
                    <div class="h-[20px] w-[200px] mx-auto border-b-2 border-gray-500 mb-[30px]"></div>
                    <p class="text-center">Now go back to login page and sign in</p>
                    <div class="flex justify-center items-center mt-[40px]">
                        <img width="450" src="frontend/src/img/Young woman.png" alt="" class="">
                    </div>
                    <button
                        class="bg-orange-500 text-white font-bold rounded-full py-2 px-4 flex mx-auto mt-[70px]">go back to log in
                            <img width="10" type="submit" src="frontend/src/svg/arrow_right.svg" class="mt-2 ml-3"/>
                    </button>
                </div>
            </div>
        </div>
    </form>

    <script>
        var currentPage = 1;
        var firstnameInput = document.querySelector("input[name='firstname']");
        var lastnameInput = document.querySelector("input[name='lastname']");
        var addressInput = document.querySelector("input[name='address']");
        var cityInput = document.querySelector("input[name='city']");
        var countryInput = document.querySelector("input[name='country']");
        var regionInput = document.querySelector("input[name='region']");
        var emailInput = document.querySelector("input[name='email']");
        var phoneInput = document.querySelector("input[name='phone']");
        var zipInput = document.querySelector("input[name='zip']");
        var farm_name = document.querySelector("input[name='farm_name']");
        var farm_address = document.querySelector("input[name='farm_address']");
        var farm_city = document.querySelector("input[name='farm_city']");
        var farm_country = document.querySelector("input[name='farm_country']");
        var farm_region = document.querySelector("input[name='farm_region']");
        var farm_emailInput = document.querySelector("input[name='farm_email']");
        var farm_phoneInput = document.querySelector("input[name='farm_phone']");
        var farm_zipInput = document.querySelector("input[name='farm_zip']");
        var roleSelect = document.getElementById("role");
        var page1Div = document.getElementById("page-1");
        var page2Div = document.getElementById("page-2");
        var page3Div = document.getElementById("page-3");
        var page4Div = document.getElementById("page-4");
        var formPages = [page1Div, page2Div, page3Div, page4Div];
        var genderSelect = document.getElementById("gender");

        function navigateNextPage() {
            if(roleSelect.value === "Customer"){
                formPages[currentPage - 2].classList.add("hidden");
                currentPage++;
                if (currentPage <= formPages.length) {
                    formPages[currentPage - 1].classList.remove("hidden");
                }
            }
            else if (currentPage <= formPages.length) {
                currentPage++;
                if (currentPage <= formPages.length) {
                    formPages[currentPage - 2].classList.add("hidden");
                    formPages[currentPage - 1].classList.remove("hidden");
                }
            }
        }
        
        function goBack() {
            if(currentPage === 2){
                roleSelect.value = null;
            }
            if (currentPage > 1) {
                formPages[currentPage - 1].classList.add("hidden");
                currentPage--;
                formPages[currentPage - 1].classList.remove("hidden");
            } else {
                window.location.href = "/";
            }
        }

        function isAlphanumeric(input) {
            // เราใช้ regular expression เพื่อตรวจสอบว่า input ประกอบด้วยตัวอักษรภาษาอังกฤษเท่านั้น
            var alphanumericRegex =/^[a-zA-Z0-9]+$/;
            return alphanumericRegex.test(input);
        }
        
        function isValidEmail(email) {
            // เราใช้ regular expression เพื่อตรวจสอบรูปแบบของอีเมล
            var emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return emailRegex.test(email);
        }


        function check_data() {

            if(currentPage === 1){
                var usernameInput = document.querySelector("input[name='username']");
                var passwordInput = document.querySelector("input[name='password']");
                // ตรวจสอบค่าของ username และ password
                if(!isAlphanumeric(usernameInput.value) || usernameInput.value.length < 2){
                    alert("กรุณากรอก Username ด้วยตัวอักษรภาษาอังกฤษหรือตัวเลขเท่านั้น");
                    return;
                }
                if(passwordInput.value.length < 2 || !isAlphanumeric(passwordInput.value)){
                    alert("กรุณากรอก Password ด้วยตัวอักษรภาษาอังกฤษหรือตัวเลขเท่านั้น");
                    return;
                }

                fetch(`/check-username/${usernameInput.value}`)
                    .then(response => response.json())
                    .then(data => {
                        if(data.exists){
                            alert("ชื่อผู้ใช้งานนี้มีผู้ใช้งานแล้ว");
                             // ไม่ไปหน้าถัดไปถ้าข้อมูลไม่ถูกต้อง
                        }
                        else{
                            navigateNextPage();
                        }
                    })
                    .catch(error => {
                        console.log("เกิดข้อผิดพลาดในการตรวจสอบ Username:", error);
                        throw error;
                    });

            } else if (currentPage === 2) {
                //เช็คค่าว่าง
                if(!firstnameInput.value.trim() || !lastnameInput.value.trim() || !addressInput.value.trim() 
                || !cityInput.value.trim() || !countryInput.value.trim() || !regionInput.value.trim() || roleSelect.value === "null" || genderSelect.value === "null"){
                    alert("กรุณากรอกข้อมูลให้ครบถ้วน");
                    return;
                }

                // ตรวจสอบค่าของอีเมลและเบอร์โทรศัพท์
                if (!isValidEmail(emailInput.value) || !emailInput.value.includes("@")) {
                    alert("กรุณากรอกอีเมลที่ถูกต้อง");
                    return; // ไม่ไปหน้าถัดไปถ้าข้อมูลไม่ถูกต้อง
                }
                if(phoneInput.value.length !== 10){
                    alert("กรุณากรอกเบอร์โทรศัพท์ 10 หลัก");
                    return;
                }
                if(isNaN(zipInput.value) || zipInput.value.length !== 5){
                    alert("กรุณากรอกรหัสไปรษณีย์ 5 หลัก และเป็นตัวเลข");//เช็คตัวเลข
                    return;
                }


                // ตรวจสอบค่าของบทบาทที่ผู้ใช้เลือก
                if (roleSelect.value === "Customer") {
                    currentPage = 3;
                }
                navigateNextPage();

            } else if(currentPage === 3){
                //เช็คค่าว่าง
                if(!farm_name.value.trim() || !farm_emailInput.value.trim() || !farm_phoneInput.value.trim() 
                || !farm_address.value.trim() || !farm_city.value.trim() || !farm_country.value.trim() || !farm_region.value.trim() || !farm_zipInput.value.trim()){
                    alert("กรุณากรอก Username ด้วยตัวอักษรภาษาอังกฤษหรือตัวเลขเท่านั้น");
                    return;
                }
                if (!farm_emailInput.value.includes("@") || !isValidEmail(farm_emailInput.value)) {
                    alert("กรุณากรอกอีเมลที่ถูกต้อง");
                    return; // ไม่ไปหน้าถัดไปถ้าข้อมูลไม่ถูกต้อง
                }
                if(farm_phoneInput.value.length !== 10 || isNaN(farm_zipInput.value)){
                    alert("กรุณากรอกเบอร์โทรศัพท์ 10 หลัก และเป็นตัวเลข");
                    return;
                }
                if(isNaN(farm_zipInput.value) || farm_zipInput.value.length !== 5){
                    alert("กรุณากรอกรหัสไปรษณีย์ 5 หลัก และเป็นตัวเลข");//เช็คตัวเลข
                    return;
                }
                navigateNextPage();
            }
        }
        
    </script>

</body>
</html>
